/*! TenVideoUploader - v2.0.0 - 2017-07-24 21:00:10
 * Copyright (c) 2017
 * Powered by Tencent-Video Web Front End Team
 */
!function(a,b,c,d){var e=a(b,c,d);c.tvu=e,"function"==typeof define&&(define.cmd||define.amd)&&define(e)}(function(a,b,c,d){function e(a){function b(){z||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(z=!0,a&&a(),b=function(){},d.onload=d.onreadystatechange=null)}if(!c.getElementById("tcapiframeapi")){var d=c.createElement("script");d.id="tcapiframeapi";var e="https://ssl.captcha.qq.com/template/TCapIframeApi.js?",f={aid:s,uin:o.config.common.uin,clientype:2,apptype:1,rand:Math.random()},g=[];for(var h in f)if(f.hasOwnProperty(h)){var i=h+"="+f[h];g.push(i)}e+=g.join("&"),d.src=e,d.onload=d.onreadystatechange=b,c.body.appendChild(d)}}function f(){if(!c.getElementById(p)){var a=c.createElement("div");a.id=r,a.setAttribute("class","mod_pop_mask"),a.setAttribute("style","display: none");var b=c.createElement("div");b.id=p,b.setAttribute("class","mod_pop"),b.innerHTML='<div class="mod_pop_hd" style="position:relative; z-index:101;"><h3></h3><a href="javascript:;" class="mod_pop_close" id="j_close_validate">关闭</a></div><div class="mod_diglog captcha_diglog" id="'+q+'" style="width:'+y+'px; height: 50px;"></div>',b.setAttribute("style","display: none; width:"+u+"px;height:"+v+"px;left:"+x+"px;top:"+w+"px;position:absolute;"),c.body.appendChild(a),c.body.appendChild(b);var d=c.getElementById("j_close_validate");d.onclick=function(a){a.preventDefault(),i(),A&&A({errorCode:-1087,errorMsg:"验证码校验失败，请重新选择文件"}),g("关闭验证浮层")}}}function g(a){var b=E;F.log_content=a||"";var c=new Image(1,1),d=[];for(var e in F)if(F.hasOwnProperty(e)){var f=e+"="+encodeURIComponent(F[e]);d.push(f)}b+=d.join("&"),c.src=b}function h(a,b){b&&("show"===a?b.style.display="block":b.style.display="none")}function i(){h("hide",c.getElementById(r)),h("hide",c.getElementById(p))}function j(){h("show",c.getElementById(r)),h("show",c.getElementById(p))}function k(a,d,e){function f(){j();var a=c.getElementById(q);try{capInit(a,{callback:function(a){0===a.ret?(i(),B&&B(a.ticket,a.randstr),g("ticket: "+a.ticket+", randstr: "+a.randstr),capRefresh()):(A&&A({errorCode:-1089,errorMsg:"验证码校验失败，请重新选择文件"}),g("关闭验证，验证码输入错误"))}}),g("验证码出现"),b.scroll(0,0)}catch(d){var e="验证码校验失败，请重新选择文件";A&&A({errorCode:-1086,errorMsg:e}),g(d.message)}}if(A=e,B=d,C=a.bid||"",D=a.upload_platform||"",!t.test(C))return void(B&&B("",""));var h=!1;o.util.ajax({url:location.protocol+"//c.v.qq.com/vcheckverification",type:"get",data:{otype:"json",bid:C,upload_platfrom:D},success:function(a){a&&"o"==a.s?1==a.is_verification?f():(B&&B("",""),g("em: "+a.em+", is_verification: "+a.is_verification)):(f(),g("错误码："+a.em+", 错误信息："+a.msg)),h=!0},error:function(a){h=!0;var b=a.status?a.status:-1088;f(),g("查询是否需要验证码请求失败，错误码："+b)}}),setTimeout(function(){h||(B&&B("",""),g("vcheckverification 请求超过了10s"))},1e4)}function l(a,b){var c=new Uint8Array(a);if("function"==typeof TextDecoder){var d=new TextDecoder(b||"utf-8").decode(c);return d}for(var e=new Array(c.length),f=0,g=c.length;g>f;f++)e[f]=String.fromCharCode(c[f]);return e.join("")}function m(a){for(var b=a.toString(),c=[],d=0;d<b.length;d+=2)c.push(parseInt(b.substr(d,2),16));return new Uint8Array(c).buffer}function n(a,b){if("function"==typeof TextEncoder){var c=new TextEncoder(b||"utf-8").encode(a);return c.buffer}for(var d=new Array(a.length),e=0,f=a.length;f>e;e++)d[e]=a.charCodeAt(e);var g=new Uint8Array(d);return g.buffer}var o={debug:!1};o.util={simpleXmlToJson:function(a){var b={};if(!a)return"";if(3==a.nodeType&&(b=a.nodeValue),a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c),e=d.nodeName.toLowerCase();if(/^#/.test(e)&&3===d.nodeType)return d.nodeValue;if("undefined"!=typeof b[e]){var f=b[e];"[object Array]"===Object.prototype.toString.call(f)?b[e].push(o.util.simpleXmlToJson(d)):(b[e]=[],b[e].push(f),b[e].push(o.util.simpleXmlToJson(d)))}else b[e]=o.util.simpleXmlToJson(d)}return 1!=a.nodeType||a.hasChildNodes()?b:""},log:function(a){o.debug&&b.console&&b.console.log&&b.console.log!=b.alert&&b.console.log("[tvu] "+a)},extend:function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},getGUID:function(){for(var a="",b=1;16>=b;b++)a+=Math.floor(16*Math.random()).toString(16);return a},getRealLen:function(a){return a.replace(/[^\x00-\xFF]/g,"**").length},param:function(a,b){var c=[],d="",e="";b=b||"";for(var f in a)a.hasOwnProperty(f)&&c.push(f+"="+encodeURIComponent(a[f]));return d=c.join("&"),b&&d&&(e=-1!=b.indexOf("?")?"&":"?"),b+e+d},getSubParam:function(a,b){var c,e,f={};b||(b=[]);for(var g=0,h=b.length;h>g;g++)c=b[g],e=a[c],f[c]=e===d||null===e?"":e;return f},getFileName:function(a,b){var c=a.lastIndexOf("\\");0>c&&(c=a.lastIndexOf("/"));var d=a.lastIndexOf(".");return!b||0>d?a.substring(c+1):a.substr(c+1,d-c-1)},getSizeString:function(a,b){var c=1024,d=1024*c,e=1024*d;return b||(b=1),c>a?a+"B":d>a?(a/c).toFixed(b)+"KB":e>a?(a/d).toFixed(b)+"MB":(a/e).toFixed(b)+"GB"},ajax:function(a){!a&&(a={}),"string"==typeof a.type&&"POST"==a.type.toUpperCase()?o.util.ajax.post(a):o.util.ajax.get(a)}},function(){var a,e,f,g,h,i,j,k;e=function(a,c){c.parentNode.removeChild(c),b[a]=d;try{delete b[a]}catch(e){}},f=function(a,b){var c,d,e="";for(c in a)a.hasOwnProperty(c)&&(c=b?encodeURIComponent(c):c,d=b?encodeURIComponent(a[c]):a[c],e+=c+"="+d+"&");return e.replace(/&$/,"")},g=function(){return"cb_"+o.util.getGUID()},h=function(a,b){"undefined"!=typeof a&&a(b)},i=function(a,b){"undefined"!=typeof a&&a(b)},j=function(a){"undefined"!=typeof a&&a()},k=function(a){"undefined"!=typeof a&&a()},a={},a.init=function(b){var c;for(c in b)b.hasOwnProperty(c)&&(a.options[c]=b[c]);return!0},a.get=function(a){a=a||{};var d=a.url,l=a.callbackParameter||"callback",m=a.data||{},n=c.createElement("script"),o=g(),p="?";d&&(m[l]=o,d.indexOf("?")>=0&&(p="&"),d+=p+f(m,!0),d=d.replace(/=\?/,"="+o),b[o]=function(b){"undefined"==typeof b?h(a.error,"Invalid JSON data returned"):i(a.success,b),e(o,n),j(a.complete)},n.onerror=function(){e(o,n),j(a.complete),h(a.error,"Error while trying to access the URL")},k(a.beforeSend),n.setAttribute("src",d),c.getElementsByTagName("head")[0].appendChild(n))},o.util.ajax.get=a.get}(),function(){FormSender=function(a,b,c,d){this.name="_fpInstence_"+FormSender.counter,FormSender.instance[this.name]=this,FormSender.counter++;var e=String(d).toLowerCase();"object"==typeof a&&1==a.nodeType&&"FORM"==a.tagName?this.instanceForm=a:(this.method=b||"POST",this.uri=a,this.charset="utf-8"==e||"gbk"==e||"gb2312"==e||"gb18030"==e?e:"gb2312",this.data="object"==typeof c||"string"==typeof c?c:null),this._sender=null,this.onSuccess=function(){},this.onError=function(){},this.startTime=0,this.endTime=0,this.postTime=0},FormSender.instance={},FormSender.counter=0,FormSender._errCodeMap={999:{msg:"Connection or Server error"}},FormSender.pluginsPool={formHandler:[],onErrorHandler:[]},FormSender._pluginsRunner=function(a,b){var c,d=FormSender,e=d.pluginsPool[a],f=b;if(e&&(c=e.length))for(var g=0;c>g;++g)"function"==typeof e[g]&&(f=e[g](f)||b);return f},FormSender._clear=function(b){b._sender=b._sender.callback=b._sender.errorCallback=null,o.util.userAgent.safari||o.util.userAgent.opera?setTimeout('$("#_fp_frm_'+b.name+'").remove()',50):a("#_fp_frm_"+b.name).remove(),b.endTime=+new Date,FormSender._pluginsRunner("onRequestComplete",b),b.instanceForm=null},FormSender.prototype.send=function(){if(this.startTime=+new Date,null===this._sender||void 0===this._sender){var a=c.createElement("iframe");a.id=a.name="_fp_frm_"+this.name,a.style.cssText="width:0;height:0;border-width:0;display:none;",a.callback=function(a){return function(){a.resultArgs=arguments,a.msg="ok",a.onSuccess.apply(a,arguments),FormSender._clear(a)}}(this);var b=function(a){var b=function(){a.resultArgs=arguments,a.msg=FormSender._errCodeMap[999].msg,FormSender._pluginsRunner("onErrorHandler",a),FormSender._clear(a),a.onError()};return function(){"object"!=typeof a.resultArgs&&("complete"==this.readyState||"undefined"==typeof this.readyState)&&"sended".indexOf(this.state)>-1&&(this.onload=this.onreadystatechange=null,b())}}(this);c.body.appendChild(a),a.errorCallback=b,a.onload=a.onreadystatechange=b,a.state="initing",this._sender=a}if(this.instanceForm)this.instanceForm.target=a.name=a.id,this._sender.submited=!0,this.instanceForm.submit();else{var d,e,f=this,g=o.util.userAgent.ie,h=f.data;if(e='<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset='+f.charset+'" /><meta charset="'+f.charset+'" />',g&&(d='javascript:document.open();document.domain="'+c.domain+'";var me=parent.FormSender.instance["'+f.name+'"];document.write(me.ifrHTML);document.close();'),e=e+'<script type="text/javascript">'+(g&&'document.charset="'+f.charset+'"'||"")+';document.domain="'+c.domain+'";frameElement.submited=void(0);frameElement.state="sending";</script></head><body>',e=e+'<form action="'+f.uri+'" accept-charset="'+f.charset+'" id="p" enctype="application/x-www-form-urlencoded;charset='+f.charset+'" method="post">',e+='<input type="hidden" name="qzreferrer" id="qzreferrer" />',e=e+'</form><script type="text/javascript">var me=parent.FormSender.instance["'+f.name+'"],doc=document,f=doc.getElementById("p"),d=me.jsonData,fg=doc.createDocumentFragment();if(typeof d=="string"){var l=d.split("&");for(var i=0;i<l.length;i++){var kv=l[i].split("=");var ipt=doc.createElement("input");ipt.type="hidden";ipt.name=kv[0];ipt.value=decodeURIComponent(kv[1]);fg.appendChild(ipt);}}else{for(var i in d){var ipt=doc.createElement("input");ipt.type="hidden";ipt.name=i;ipt.value=d[i];fg.appendChild(ipt);}}f.appendChild(fg);doc.getElementById("qzreferrer").value=parent.location.href;f.submit();me.postTime=+new Date;frameElement.submited=true;frameElement.state="sended";</script></body></html>',f.ifrHTML=e,f.ifrurl=d,f.jsonData=h,g?setTimeout(function(a){return function(){a._sender.state="inited",a._sender.src=a.ifrurl}}(f),10):a.src="javascript:;",!g){var i=a.contentDocument||a.contentWindow.document;i&&(i.open(),i.write(f.ifrHTML),i.close())}}return!0},FormSender.prototype.destroy=function(){var a=this.name;return delete FormSender.instance[a]._sender,FormSender.instance[a]._sender=null,delete FormSender.instance[a],FormSender.counter--,null},o.util.ajax.post=function(a){var b,c,d,e,f=success=error=complete=function(){};c=a.url,d=a.data,e=a.charset||"utf-8",f=a.beforeSend||f,success=a.success||success,error=a.error||error,complete=a.complete||complete,b=new FormSender(c,"POST",d,e),b.onSuccess=function(a){success.apply(null,arguments),complete()},b.onError=function(){error.apply(null,arguments),complete()},f(),b.send()}}(),function(){var a,d,e=o.util.userAgent={},f=navigator.userAgent;navigator.appVersion;b.ActiveXObject?(e.ie=6,(b.XMLHttpRequest||f.indexOf("MSIE 7.0")>-1)&&(e.ie=7),(b.XDomainRequest||f.indexOf("Trident/4.0")>-1)&&(e.ie=8),f.indexOf("Trident/5.0")>-1&&(e.ie=9),f.indexOf("Trident/6.0")>-1&&(e.ie=10),e.isBeta=navigator.appMinorVersion&&navigator.appMinorVersion.toLowerCase().indexOf("beta")>-1):c.getBoxObjectFor||"undefined"!=typeof b.mozInnerScreenX?(a=/(?:Firefox|GranParadiso|Iceweasel|Minefield).(\d+\.\d+)/i,e.firefox=parseFloat((a.exec(f)||a.exec("Firefox/3.3"))[1],10)):navigator.taintEnabled?b.opera?e.opera=parseFloat(b.opera.version(),10):/Trident\/\d+.+rv:(\d+\.\d+?)/i.test(f)?e.ie=RegExp.$1:e.ie=6:(d=/AppleWebKit.(\d+\.\d+)/i.exec(f),e.webkit=d?parseFloat(d[1],10):c.evaluate?c.querySelector?525:420:419,(d=/(?:Chrome|CriOS).(\d+\.\d+)/i.exec(f))||b.chrome?e.chrome=d?parseFloat(d[1],10):"2.0":((d=/Version.(\d+\.\d+)/i.exec(f))||b.safariHandler)&&(e.safari=d?parseFloat(d[1],10):"3.3"),e.air=f.indexOf("AdobeAIR")>-1?1:0,e.isiPod=f.indexOf("iPod")>-1,e.isiPad=f.indexOf("iPad")>-1,e.isiPhone=f.indexOf("iPhone")>-1),(e.macs=f.indexOf("Mac OS X")>-1)||(e.windows=(d=/Windows.+?(\d+\.\d+)/i.exec(f),d&&parseFloat(d[1],10)),e.linux=f.indexOf("Linux")>-1,e.android=f.indexOf("Android")>-1),e.iOS=f.indexOf("iPhone OS")>-1,!e.iOS&&(d=/OS (\d+(?:_\d+)*) like Mac OS X/i.exec(f),e.iOS=d&&d[1]?!0:!1)}(),o.global={fios:{},BusinessType:{COMMON:"common",BOKE:"boke",QZONE:"qzone",WEIBO:"weibo",CLASS:"class",WEIXIN:"weixin",OPEN:"open",ACCESS:"access"},UploadType:{FTN:2,HTML5:3,FLASH:1,FTN_HTML5:4},UploadStatus:{READY:0,SCAN:1,UPLOAD:2,SUCCESS:3,CANCEL:4,FAIL:5,INVALID:6},ErrorCode:{1001:"未登录",1791:"Flash正在上传不能选择文件",1750:"视频文件大小不正确，暂时无法上传",1751:"文件传输发生错误，暂时无法上传",1752:"文件正在被其他程序占用，暂时无法上传",1753:"安全性校验失败，暂时无法上传",1754:"发生意外错误，暂时无法上传",1755:"文件总大小发生变化，暂时无法上传",1756:"文件校验错误，暂时无法上传",1758:"检测到文件大小为0，暂时无法上传",1759:"视频文件太小，暂时无法上传",1800:"发生未知错误，暂时无法上传",7000:"暂不支持该格式",7001:"文件没有扩展名",7002:"文件名超长",7003:"文件超过限制大小",7004:"文件大小为0",8001:"文件发送时出现错误",8002:"上传CGI返回未知错误",8003:"上传CGI返回超时",9002:"申请上传返回值为空",9003:"申请上传调用失败"},errorCodeMap:{"":""},getUploaderName:function(a){var b="";switch(a){case o.global.UploadType.FTN:b="ftn";break;case o.global.UploadType.FTN_HTML5:b="ftnhtml5";break;case o.global.UploadType.HTML5:b="html5";break;case o.global.UploadType.FLASH:b="flash"}return b},getUploader:function(a){var b=this.getUploaderName(a),c=null;return b&&(c=o[b+"Uploader"]),c},addFio:function(a){a&&!this.fios[a.uid]&&(this.fios[a.uid]=a)},getFio:function(a){return this.fios[a]||null},getErrorMsg:function(a){return this.ErrorCode[a]||""}},o.config={event:{onSelect:a.noop,onStart:a.noop,onUploadStart:a.noop,onScanProgress:a.noop,onUploadProgress:a.noop,onSuccess:a.noop,onError:a.noop,onDragEnterPage:a.noop,onDragLeavePage:a.noop,onDragEnterTarget:a.noop,onDragLeaveTarget:a.noop,onDropTarget:a.noop},common:{uin:0,encuin:"",g_tk:"",businessID:"",selectButton:null,useMultiSelect:!1,maxFileNameLength:255,timeout:120,reportCgi:"http://rcgi.video.qq.com/report/upload",installFtnUrl:"http://mail.qq.com/cgi-bin/readtemplate?t=browser_addon&check=false&s=install&returnto=",fileType:"*.mp4;*.flv;*.f4v;*.webm;*.m4v;*.mov;*.3gp;*.3g2;*.rm;*.rmvb;*.wmv;*.avi;*.asf;*.mpg;*.mpeg;*.mpe;*.ts;*.div;*.dv;*.divx;*.vob;*.dat;*.mkv;*.swf;*.lavf;*.cpk;*.dirac;*.qt;*.fli;*.flc;*.mod;",sort:400,uploadInfo:{bid:"",cid:"",title:"",tags:"",cat:"",desc:"",platform:"",appid:"",pluginsession:"",username:"",open_uid:"",open_token:"",convConf:"",verification_key:"",upload_platform:"",addrtype:0}}},o.reporter={Step:{BEFORE:1,START:2,PAUSE:3,SENT:4,FINISHED:5,CANCEL:6,UPLOADING:7,RETRY:21},ErrorType:{NO:0,HTTP:1,CGI:2,PLUGIN:3},report:function(c,d){function e(d){var e,f,g,h,i=o.global.getFio(d),j=o.global.getUploader(i.uploadType).config,k={step:c,sort:o.config.common.sort,upid:i.uid,uptype:i.uploadType,vid:i.vid,curl:encodeURIComponent(b.location.href),fsize:i.size,upsize:i.processedSize,speed:i.averageSpeed,duration:i.startTime?a.now()-i.startTime:0,errcode:i.errorCode,errtype:0,upcgi:""};switch(i.uploadType){case o.global.UploadType.FTN:a.extend(k,{exists:i.exists,serip:i.serverip,fstep:i.fstep});break;case o.global.UploadType.HTML5:break;case o.global.UploadType.FLASH:a.extend(k,{surl:j.src,pfversion:j.version})}if(k.errcode){var l="";c==o.reporter.Step.BEFORE?(e=j.tcgi,f=j.tcgiParamKeys):(e=j.upcgi,f=j.upcgiParamKeys),e&&(g=a.extend({},i),g=o.util.getSubParam(g,f),g.uin=o.config.common.uin,g.g_tk=o.config.common.g_tk,l=o.util.param(g,e)),a.extend(k,{errtype:i.errorType,upcgi:l})}return h=o.util.param(k,o.config.common.reportCgi)}function f(a){e(a)}c==o.reporter.Step.UPLOADING?null==d.reportTimer&&(f(d.uid),d.reportTimer=setInterval(function(a){return function(){f(a)}}(d.uid),6e4)):(f(d.uid),null==d.reportTimer||c!=o.reporter.Step.SENT&&c!=o.reporter.Step.FINISHED&&c!=o.reporter.Step.CANCEL||(clearInterval(d.reportTimer),d.reportTimer=null))}},o.bossReporter={STEP:{SELECT:"select file",BEFORE:"before upload",SCANSTART:"scan start",SCANNING:"scanning",SCANERROR:"scan error ",UPLOADSTART:"upload start",UPLOADING:"uploading",PAUSE:"upload pause",SENT:"upload 100% percent",SENDERROR:"send error ",FINISHED:"upload finished",CANCEL:"upload cancel",RETRY:"upload retry"},LOG_LEVEL:{LOG:1,WARN:2,ERROR:3,UNCAUGHTERROR:4,SPECIAL:5},DEFAULT_REPORT_URL:"//btrace.qq.com/kvcollect?BossId=3221&Pwd=957851803",ua:function(){function a(){return d.windows?"windows "+d.windows:d.macs?"macs "+d.macs:d.linux?"linux "+d.linux:void 0}function b(){var a=navigator.userAgent;return d.chrome?a.indexOf("QQBrowser")>-1||a.indexOf("TencentTraveler")>-1?"QQBrowser-chrome":a.indexOf("360SE")>-1?"360Browser-chrome":a.indexOf("SE")&&a.indexOf("MetaSr")>-1?"sougouBrowser-chrome":a.indexOf("Maxthon")>-1?"遨游-chrome":a.indexOf("UCWEB")>-1?"UCWEB-chrome":"chrome":d.ie?"ie":d.safari?"safari":d.firefox?"firefox":void 0}function c(){var a=b();return d[a]}var d=o.util.userAgent;return{os:a(),navigator:b(),navigatorVersion:c()}},queueMap:{_dc:Math.random()},count:0,savedCount:0,maxCount:128,defaultReportTimes:30,reportTimesMap:{},doReport:function(a){var b=this;b.count++;for(var c in a)a.hasOwnProperty(c)&&a[c]&&(b.queueMap[c]?b.queueMap[c]+="$"+(""+a[c]).replace("&","%26"):b.queueMap[c]=(""+a[c]).replace("&","%26"));a.isRightNow?(b.sendReport(),b.savedCount=b.count):(setTimeout(function(){b.count>b.savedCount&&o.config.common.isReportBoss&&(b.sendReport(),b.savedCount=b.count)},5e3),b.count>=b.maxCount&&o.config.common.isReportBoss&&b.sendReport())},sendReport:function(){var a=this,b=new Image,c=o.util.param(a.queueMap,a.DEFAULT_REPORT_URL);b.src=c,a.reset()},reset:function(){var a=this;a.queueMap={_dc:Math.random()},a.count=0,a.savedCount=0},getCookie:function(a){var b,d=c.cookie;if("undefined"!=typeof this._cookieMap)return this._cookieMap[a];this._cookieMap={};for(var e=d.split(";"),f=0,g=e.length;g>f;f++){var h=e[f].split("="),i=h[0].replace(/\s*/,"");i===a&&(b=h[1]),this._cookieMap[i]=h[1]}return b},report:function(a){var b=this;a=a||{};var d=a.step||a.errorMsg||"-",e=b.ua(),f=e.navigatorVersion||"-",g=e.navigator||"-",h=e.os||"-",i=o.config.common.uin||"-";"om.qq.com"===location.hostname&&(i=this.getCookie("userid"));var j=a.url||location.href,k=a.refer||c.referrer,l=a.vid||"-",m=a.isRightNow||!1,n=a.uploadServer||"",p=a.uploadTime||0,q=a.uploadInstantSpeed/1024||0,r=a.uploadAverageSpeed/1024||0,s=a.fileSize/1024/1024||0;b.doReport({log_content:d,ua_navigator_version:f,ua_navigator:g,ua_os:h,uin:i,vid:l,url:j,refer:k,log_level:a.log_level||b.LOG_LEVEL.LOG,isRightNow:m,user_time:this.getUserTime(),upload_server:n,upload_time:p,upload_instant_speed:q,upload_average_speed:r,file_size:s})},fixZero:function(a){return 10>a?"0"+a:""+a},getUserTime:function(){var a=new Date,b=this.fixZero(a.getFullYear()),c=this.fixZero(a.getDate()),d=this.fixZero(a.getMonth()+1),e=this.fixZero(a.getHours()),f=this.fixZero(a.getMinutes()),g=this.fixZero(a.getSeconds());return b+"-"+d+"-"+c+" "+e+":"+f+":"+g},reportLog:function(a){var b=this;a.log_level=b.LOG_LEVEL.LOG,b.report(a)},reportWarn:function(a){var b=this;a.log_level=b.LOG_LEVEL.WARN,b.report(a)},reportError:function(a){var b=this;a.log_level=b.LOG_LEVEL.ERROR,b.report(a)},reportUncaughtError:function(a){var b=this,c=a.rkey||"-";b.reportTimesMap[c]?b.reportTimesMap[c]++:b.reportTimesMap[c]=1,b.reportTimesMap[c]>b.defaultReportTimes||(a.log_level=b.LOG_LEVEL.UNCAUGHTERROR,b.report(a))},reportChangeOldVersionClick:function(){var a=this,b={};b.log_level=a.LOG_LEVEL.SPECIAL,b.isRightNow=!0,a.report(b)}};var p="cap_box",q="cap_container",r=p+"_mask",s="1600000650",t=/boke/,u=345,v=400,w=(b.innerHeight?b.innerHeight-v:c.documentElement.clientHeight-v)/2,x=(b.innerWidth?b.innerWidth-u:c.documentElement.clientWidth-u)/2,y=u-60,z=!1,A=function(){},B=function(){},C="",D="",E="http://btrace.qq.com/kvcollect?BossId=3703&Pwd=1037536757&",F={uin:o.config.common.uin,ua:navigator.userAgent,url:location.href,log_content:""};o.validateCode={init:function(a){t.test(a)&&(F.uin=o.config.common.uin,e(),f())},validate:k},o.FileInfo=function(a,b,c,d,e){this.uploadType=a,this.uid=o.util.getGUID(),this.uploadKey="",this.uploadStatus=o.global.UploadStatus.READY,this.size=b,this.name=c,this.path=d||"",this.vid="",this.fid="",this.type=o.config.common.businessID,this.folder="",this.act="",this.uptype=a,this.fsize=b,this.orifname=c,this.title=e?e.title:o.util.getFileName(c,!0),this.tags=e?e.tags:"",this.desc=e?e.desc:"",this.cat=e?e.cat:"",this.platform=e?e.platform:"",this.bid=e?e.bid:"",this.upload_platform=e?e.upload_platform:"",this.verification_key="",this.cid=e?e.cid:"",this.cgi=e?e.cgi:"",this.appid=e?e.appid:"",this.pluginsession=e?e.pluginsession:"",this.username=e?e.username:"",this.open_uid=e?e.open_uid:"",this.open_token=e?e.open_token:"",this.convconf=e?e.convconf:"",this.addrtype=e?e.addrtype:"",this.key="",this.from="",this.autoRetryNum=0,this.exists="",this.checkkey="",this.serverip="",this.serverport="",this.sha="",this.sha3="",this.md5="",this.fstep=0,this.upsize=0,this.upid=this.uid,this.percent=0,this.averageSpeed=0,this.instantSpeed=0,this.processedSize=0,this.startSize=0,this.errorCode=0,this.errorMsg="",this.errorType=o.reporter.ErrorType.NO,this.reportTimer=null,this.firstReport=!1,this.startTime=0,this.lastTime=0,this.stopNum=0},o.FileInfo.reset=function(a){a&&a instanceof o.FileInfo&&a.uploadStatus!=o.global.UploadStatus.READY&&(a.uploadStatus=o.global.UploadStatus.READY,a.autoRetryNum=0,a.fstep=0,a.upsize=0,a.upid=o.util.getGUID(),a.percent=0,a.averageSpeed=0,a.instantSpeed=0,a.processedSize=0,a.startSize=0,a.errorCode=0,a.errorMsg="",a.errorType=o.reporter.ErrorType.NO,a.reportTimer=null,a.firstReport=!1,a.startTime=0,a.lastTime=0,a.stopNum=0)},o.baseUploader=function(){function b(){}return b.prototype={getFio:function(a){var b=this,c=b.keyToUidMap[a],d=o.global.getFio(c);return d},setSelectButton:function(b){var c,d,e,f,g,h,i=this;i.inited&&(b&&0!=b.length||(b=a(i.config.selectButton),0!=b.length))&&(g=i.getSelectButtonOverlay(),g?(f=a(g),h="none"==b.css("display"),h&&b.css({visibility:"hidden",display:""}),c=b.offset(),d=b.outerWidth(),e=b.outerHeight(),h&&b.css({display:"none",visibility:""}),f.css({left:c.left+"px",top:c.top+"px",width:d+"px",height:e+"px","z-index":"8888"}).attr({width:d,height:e})):(a(i.config.selectButton).unbind("click"),b.bind("click",function(){i.openSelectFileWindow()})),i.config.selectButton=b)},checkFile:function(a){var b,c,d=this,e=0;b=a.name.lastIndexOf("."),1790==a.errorCode?(e=7003,a.size=-1):1791==a.errorCode||(0==a.size?e=7004:a.size>=1024*d.config.maxFileSize*1024||a.size<0?e=7003:o.util.getRealLen(a.name)>o.config.common.maxFileNameLength?e=7002:b>0?(c=a.name.substr(b).toLowerCase(),(-1==o.config.common.fileType.indexOf(c+";")||".dat"==c&&a.size<512e3)&&(e=7e3)):e=7001),0!=e&&(a.errorCode=e)},getVid:function(b,c,d){var e=this,f=e.config.tcgiParamKeys,g=a.extend({},b),h=e.config.tcgiHttpMethod,i=o.util.param({g_tk:o.config.common.g_tk},e.config.tcgi);g=o.util.getSubParam(g,f),a.extend(g,{uin:o.config.common.uin,encuin:o.config.common.encuin,g_tk:o.config.common.g_tk,otype:"json"}),b.ticket&&(g.verification_key=b.ticket,g.verification_code=b.randstr),g.upload_platform&&(g.upload_platfrom=g.upload_platform,delete g.upload_platform),o.util.ajax({url:i,type:h,data:g,success:function(a){a&&"o"==a.s?(c(a),o.bossReporter.report({errorMsg:"getVid: "+a.vid})):(a||(a={em:9002,msg:"申请上传返回值为空"}),d(a))},error:function(a){var b=a&&a.status;d({em:b||9003,msg:b?"申请上传调用失败":a})}})},handleProgressData:function(b,c,d){if(b&&null!=b.lastTime&&null!=b.startTime){var e,f=a.now(),g=f-b.lastTime,h=f-b.startTime,i=c.bytesProcessed;if(0==g&&(g=.01),0==h&&(h=.01),i>b.size&&(i=b.size),d){if(262144==i)return 0;e=0==b.startSize,e&&(b.startSize=i)}return b.instantSpeed=Math.round(1e3*(i-(d&&e?b.startSize:0)-b.processedSize)/g),b.instantSpeed<0&&(b.instantSpeed=0),b.averageSpeed=Math.round(1e3*(i-(d?b.startSize:0))/h),b.averageSpeed<0&&(b.averageSpeed=0),b.percent=(i/b.size*100).toFixed(1),b.processedSize=i,b.lastTime=f,g}},inited:!1,config:{},keyToUidMap:{},init:a.noop,start:a.noop,cancel:a.noop,isSupport:function(){return!1},selectFile:a.noop,openSelectFileWindow:a.noop,getSelectButtonOverlay:a.noop},b}(),o.config.ftn={id:"tvu_ftnuploader_obj",maxFileSize:o.util.userAgent.ie?4096:2048,selectButton:null,tcgi:"//c.v.qq.com/openfvupready",tcgiParamKeys:["vid","type","tags","cid","bid","platform","cat","desc","act","title","folder","orifname","size","uptype","sha","sha3","md5","key"],tcgiHttpMethod:"post",blockSize:262144,autoRetry:!1,maxAutoRetryNum:3,style:"height:0;width:0;margin:0;padding:0;",containerStyle:"height:0;width:0;margin:0;padding:0;visibility:hidden;overflow:hidden;"},o.ftnUploader=function(){function d(){function d(){var b=[];if(!y)if(o.util.userAgent.ie)try{y=new ActiveXObject("TXFTNActiveX.FTNUpload")}catch(d){o.util.log("ftn activex init fail")}else navigator.mimeTypes&&navigator.mimeTypes["application/txftn-webkit"]?(b.push('<div style="',x.containerStyle,'"><embed id="',x.id,'" type="application/txftn-webkit" style="',x.style,'"></embed></div>'),a(c.body).append(b.join("")),y=c.getElementById(x.id)):o.util.log("ftn webkit init fail");return!!y}function e(){y.OnEvent=u,y.BlockSize=x.blockSize;try{y.TimeOut=1e3*w.common.timeout}catch(b){o.util.log("ftn set timeout fail")}a(x.selectButton).bind("click",function(a){f(),a.preventDefault()})}function f(){try{var a,c,d=[];if(!v.inited)return;if(o.util.userAgent.firefox&&y.focus(),w.useMultiSelect||"undefined"==typeof y.SelectFile?o.util.userAgent.firefox&&y.SelectFilesAsync?y.SelectFilesAsync(b,function(b){if(a=b){a=a.replace(/^\r\n/,"").replace(/\r\n$/,"").split("\r\n");for(var e=0,f=a.length;f>e;e++)c=a[e],c&&d.push(g(c));h(d)}}):y.SelectFiles?a=y.SelectFiles(b):o.util.userAgent.firefox&&alert("为保障您稳定优质的上传体验，建议您按照浏览器顶部提示安装控件，并选择允许长期运行\n如果已经安装，则直接选择允许长期运行，最后刷新页面即可"):a=y.SelectFile(b),!a)return;a=a.replace(/^\r\n/,"").replace(/\r\n$/,"").split("\r\n");for(var e=0,f=a.length;f>e;e++)c=a[e],c&&d.push(g(c));h(d)}catch(i){o.bossReporter.reportUncaughtError({errorMsg:i.message+" at function selectFile in file tvu.ftnuploader.js"})}}function g(a){var b,c,d;return b="undefined"!=typeof y.GetFileSizeString?y.GetFileSizeString(a):y.GetFileSize(a),b=Math.abs(b||0),c=o.util.getFileName(a),d=new o.FileInfo(o.global.UploadType.FTN,b,c,a,w.common.uploadInfo)}function h(a){w.event.onSelect(a),o.bossReporter.report({step:"use ftn"}),o.bossReporter.report({step:o.bossReporter.STEP.SELECT})}function i(b){var c=v.getFio(b.uploadKey);c.md5=b.md5,c.sha=b.sha,c.sha3=b.sha3,c.percent=0,c.averageSpeed=0,c.instantSpeed=0,c.processedSize=0,c.startSize=0,v.getVid(c,function(b){c.exists=b.exists,c.checkkey=b.checkkey,c.vid=b.vid,c.fid=b.fid,c.serverip=b.serverip,c.serverport=b.serverport,o.reporter.report(o.reporter.Step.BEFORE,c),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE,vid:c.vid}),w.event.onUploadStart(c),o.reporter.report(o.reporter.Step.UPLOADING,c),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADING,vid:c.vid}),c.uploadStatus=o.global.UploadStatus.UPLOAD,c.startTime=c.lastTime=a.now(),t(c)},function(a){c.errorCode=a.em,c.errorMsg=a.msg,c.errorType=o.reporter.ErrorType.CGI,c.dupli_info=a.dupli_info,o.reporter.report(o.reporter.Step.BEFORE,c),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE+c.errorMsg,vid:c.vid}),q(c)})}function j(a){try{var b,c=v.getFio(a.uploadKey);a.uploadKey||o.bossReporter.reportUncaughtError({rkey:"ftnuploader-onScanProgress",errorMsg:"no uploadKey"}),b=v.handleProgressData(c,a),w.event.onScanProgress(c),c.firstBossReportScanning||(o.bossReporter.report({step:o.bossReporter.STEP.SCANNING,vid:c.vid}),c.firstBossReportScanning=1)}catch(d){o.bossReporter.reportUncaughtError({rkey:"ftnuploader-onScanProgress",errorMsg:d.message+" at function onScanProgress in file tvu.ftnuploader.js "})}}function k(a){try{var b,c=v.getFio(a.uploadKey);if(b=v.handleProgressData(c,a,!0),0==b)return;0==c.firstReport&&(c.firstReport=1,o.reporter.report(o.reporter.Step.START,c),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADSTART,vid:c.vid})),1e3>b||b>1e4&&c.stopNum<60&&(c.fstep=a.fstep,o.reporter.report(o.reporter.Step.PAUSE,c),o.bossReporter.report({step:o.bossReporter.STEP.PAUSE,vid:c.vid}),c.stopNum++),w.event.onUploadProgress(c)}catch(d){o.bossReporter.reportUncaughtError({rkey:"ftnuploader-onSendProgress",errorMsg:d.message+" at function onSendProgress in file tvu.ftnuploader.js "})}}function l(a){var b=v.getFio(a.uploadKey);b.fstep=a.fstep,o.reporter.report(o.reporter.Step.SENT,b),o.bossReporter.report({step:o.bossReporter.STEP.SENT,vid:b.vid})}function m(a){var b=v.getFio(a.uploadKey);b.percent="100.0",b.fstep=a.fstep,o.reporter.report(o.reporter.Step.FINISHED,b),o.bossReporter.report({step:o.bossReporter.STEP.FINISHED,vid:b.vid}),b.uploadStatus=o.global.UploadStatus.SUCCESS,w.event.onSuccess(b)}function n(a){var b=v.getFio(a.uploadKey);b.errorCode=a.errorCode,b.errorType=o.reporter.ErrorType.PLUGIN,b.fstep=a.fstep,o.reporter.report(o.reporter.Step.PAUSE,b),o.bossReporter.report({step:o.bossReporter.STEP.SCANERROR+b.errorMsg,vid:b.vid}),q(b)}function p(a){var b=v.getFio(a.uploadKey);b.errorCode=a.errorCode,b.errorType=o.reporter.ErrorType.PLUGIN,b.fstep=a.fstep,x.autoRetry&&b.autoRetryNum<x.maxAutoRetryNum?(b.autoRetryNum++,o.reporter.report(o.reporter.Step.RETRY,b),o.bossReporter.report({step:o.bossReporter.STEP.RETRY,vid:b.vid}),t(b)):(o.reporter.report(o.reporter.Step.FINISHED,b),o.bossReporter.reportError({step:o.bossReporter.STEP.SENDERROR+", errorCode: "+b.errorCode+", errorMsg: "+b.errorMsg,vid:b.vid}),q(b))}function q(a){a.uploadStatus=o.global.UploadStatus.FAIL,w.event.onError(a),o.bossReporter.reportError({errorMsg:"error, errorCode: "+a.errorCode+", errorMsg: "+a.errorMsg,vid:a.vid})}function r(a){w.event.onStart(a),s(a)}function s(b){b.uploadStatus=o.global.UploadStatus.SCAN,b.startTime=b.lastTime=a.now(),b.uploadKey=y.FileSign(b.path,b.uid),z[b.uploadKey]=b.uid}function t(a){a.uploadStatus!=o.global.UploadStatus.CANCEL&&(delete z[a.uploadKey],a.uploadKey=y.UploadFile(a.serverip,a.serverport,a.checkkey,a.sha,"/"+a.vid,a.path,a.uid),z[a.uploadKey]=a.uid)}function u(a){var b;if(a&&a.LocalID)switch(b=a.LocalID,a.EventType){case 1:0==a.ErrorCode&&0==a.Step?i({uploadKey:b,md5:a.Md5,sha:a.SHA,sha3:a.SHA3,fstep:a.Step}):n({uploadKey:b,errorCode:a.ErrorCode,fstep:a.Step});break;case 2:j({uploadKey:b,bytesProcessed:a.Processed>>>0,bytesTotal:a.FileSize>>>0,fstep:a.Step});break;case 3:0==a.ErrorCode&&0==a.Step?(l({uploadKey:b,fstep:a.Step}),m({uploadKey:b,fstep:a.Step})):p({uploadKey:b,errorCode:a.ErrorCode,fstep:a.Step});break;case 4:k({uploadKey:b,bytesProcessed:a.Processed>>>0,bytesTotal:a.FileSize>>>0,fstep:a.Step})}}var v=this,w=o.config,x=w.ftn,y=null,z={};this.inited=!1,this.keyToUidMap=z,this.config=x,this.init=function(){if(!v.inited){if(!d())return;e();var a=o.config&&o.config.common&&o.config.common.uploadInfo&&o.config.common.uploadInfo.bid;o.validateCode.init(a),v.inited=!0}},this.start=function(a){v.inited&&o.validateCode.validate({bid:a.bid,upload_platform:a.upload_platform},function(b,c){a.ticket=b,a.randstr=c,r(a)},function(b){a.errorCode=b.errorCode,a.errorMsg=b.errorMsg,q(a),v.cancel(a)})},this.cancel=function(a){v.inited&&(o.reporter.report(o.reporter.Step.CANCEL,a),o.bossReporter.report({step:o.bossReporter.STEP.CANCEL,vid:a.vid}),a.uploadStatus==o.global.UploadStatus.SCAN?"undefined"!=typeof y.StopFileSign&&y.StopFileSign(a.uploadKey):a.uploadStatus==o.global.UploadStatus.UPLOAD&&y.StopUpload(a.uploadKey))},this.isSupport=function(){if(o.util.userAgent.firefox){for(var a=0,b=navigator.plugins||[],c=0;c<b.length;c++)if("Tencent FTN plug-in"==b[c].name){var e=b[c].version.replace(/\./g,"");e>=a&&(a=e)}return 1006>a?!1:!0}return d()},this.selectFile=function(a,b){var c=null;return v.inited&&a&&(c=g(a,b),b&&(c.vid=b),h([c])),c},this.openSelectFileWindow=function(){v.inited&&f()}}return o.util.extend(d,o.baseUploader),new d}(),o.config.ftnhtml5={id:"tvu_ftnhtml5uploader_obj",maxFileSize:4096,selectButton:null,dropTarget:null,tcgi:"//c.v.qq.com/vupready",tcgiParamKeys:["vid","type","tags","cid","bid","platform","cat","desc","act","title","folder","orifname","size","uptype","sha","sha3","md5","key","addrtype"],tcgiHttpMethod:"post",
width:"0",height:"0",style:"height:0;width:0;margin:0;padding:0;",containerStyle:"height:0;width:0;margin:0;padding:0;visibility:hidden;overflow:hidden;",workerPath:location.protocol+"//imgcache.qq.com/tencentvideo_v1/tvu/js/ftnh5/tvu.uploader.worker.js?v=20170526&l="+location.hostname+"_"+location.port},o.ftnhtml5=o.ftnhtml5||{},function(a,b){o.ftnhtml5=o.ftnhtml5||{},o.ftnhtml5.Emitter=b()}(b,function(){function a(a){return a?b(a):void 0}function b(b){for(var c in a.prototype)b[c]=a.prototype[c];return b}return a.prototype.on=a.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},a.prototype.one=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},a.prototype.off=a.prototype.removeListener=a.prototype.removeAllListeners=a.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},a.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},a.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},a.prototype.hasListeners=function(a){return!!this.listeners(a).length},a}),function(a,b){o.ftnhtml5=o.ftnhtml5||{},o.ftnhtml5.CONST_DEF=b()}(self||b,function(){var a={EventType:{SEND:{FILE_SCAN:11,FILE_SCAN_CANCEL:12,BUF_SCAN:21,FILE_UPLOAD:31,FILE_UPLOAD_CANCEL:32},REPLY:{SCAN_START:11,SCAN_ING:12,SCAN_SUCCESS:13,SCAN_CANCEL:14,SCAN_ERROR:15,UPLOAD_START:21,UPLOAD_ING:22,UPLOAD_SUCCESS:23,UPLOAD_CANCEL:24,UPLOAD_ERROR:25,SET_FIOSTARTTIME_FIOLASTTIME:100}},AlgType:{MD5:1,SHA1:2}};return a}),function(a,b){o.ftnhtml5=o.ftnhtml5||{},o.ftnhtml5.DataDict=b()}(self||b,function(){function a(){this.buffer=null,this.byteTotalLength=0,this.fieldNum=0,this.fieldMap={},this.fieldArr=[]}return a.prototype={add:function(a){for(var b=this,c="[object Array]"===Object.prototype.toString.call(a)?a:[a],d=0,e=c.length;e>d;d++){var f=c[d],g=b.fieldNum++;f.name||(f.name="Field_"+g),f.index=g,b.fieldMap[f.name]=f}b.fieldArr=b.getFieldArray()},update:function(a,b){var c=this,d=c.fieldMap[a];if(d)for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e])},get:function(a){var b=this,c=b.fieldMap;return c[a]},getItemValue:function(a){var b=this,c=b.fieldMap;return c[a]?c[a].value:0},getItemOffset:function(a){var b=this,c=b.fieldMap;return c[a]?c[a].offset:0},remove:function(){},setBuffer:function(a){this.buffer=a,this.byteTotalLength=this.buffer.byteLength},fixEncodeField:function(){var a=this,b=a.fieldMap;for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if("string"==d.type){var e=null;e=1==d.hex?m(d.value):n(d.value,d.encoding),d.type="arraybuffer",d.length=e.byteLength,d.value=e}"arraybuffer"==d.type&&(d.length=d.value.byteLength)}for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d.calFieldName){var f=d.calFieldName;if(b[f]){var g=b[f];d.value=g.length}}}for(var h=0,i=a.fieldArr,j=0,k=i.length;k>j;j++){var d=i[j];d.offset=h,h+=d.length}},calTotalLength:function(){var a=this,b=a.fieldMap,c=0;for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];c+=e.length}a.byteTotalLength=c},encode:function(){var a=this;a.fixEncodeField(),a.calTotalLength();for(var b=a.getFieldArray(),c=a.byteTotalLength,d=new ArrayBuffer(c),e=new DataView(d),f=0,g=0,h=b.length;h>g;g++){var i=b[g];if(!(i.length<=0))switch(i.type){case"int":f=a.encodeIntField(e,i,f);break;case"arraybuffer":f=a.encodeArrayBufferField(e,i,f);break;case"string":f=a.encodeStringField(e,i,f)}}return a.buffer=d,d},encodeIntField:function(a,b,c){var d=b.length;return 1==d?a.setUint8(c,b.value,b.littleEndian):2==d?a.setUint16(c,b.value,b.littleEndian):4==d&&a.setUint32(c,b.value,b.littleEndian),c+d},encodeArrayBufferField:function(a,b,c){var d=b.length,e=new Uint8Array(a.buffer),f=new Uint8Array(b.value);return e.set(f,c),c+d},encodeStringField:function(a,b,c){var d=b.length,e=new Uint8Array(a.buffer),f=n(b.value),g=new Uint8Array(f);return e.set(g,c),c+d},decode:function(){var a=this,b=a.buffer,c=a.getFieldArray();if(!b||c.length<=0)return null;for(var d=new DataView(b),e=(new Uint8Array(b),0),f=0,g=c.length;g>f;f++){var h=c[f];switch(h.type){case"int":e=a.decodeIntField(d,h,e);break;case"arraybuffer":e=a.decodeArrayBufferField(d,h,e);break;case"string":e=a.decodeStringField(d,h,e)}}return a.fieldMap},decodeIntField:function(a,b,c){var d=this,e=b.length,f=0,g=c+e;return a.byteLength<g||(1==e?f=a.getUint8(c,b.littleEndian):2==e?f=a.getUint16(c,b.littleEndian):4==e&&(f=a.getUint32(c,b.littleEndian))),b.value=f,d.fixDecodeField(b),g},decodeArrayBufferField:function(a,b,c){var d=b.length,e=c+d;if(a.byteLength<e)b.value=null;else{var f=new Uint8Array(a.buffer,c,d);b.value=f.buffer}return e},decodeStringField:function(a,b,c){var d=b.length,e=c+d;if(a.byteLength<e)b.value="";else{var f=new Uint8Array(a.buffer,c,d);b.value=l(f.buffer,b.encoding)}return e},fixDecodeField:function(a){var b=this,c=b.fieldMap;if(a.calFieldName){var d=a.calFieldName;if(c[d]){var e=c[d];e.length=a.value}}},getFieldArray:function(){var a=this,b=a.fieldMap,c=[];for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];c.push(e)}return c.sort(function(a,b){return a.index-b.index}),c}},a}),function(a,b){o.ftnhtml5=o.ftnhtml5||{},o.ftnhtml5.WorkerAdapter=b(a)}(b,function(){function a(a,c,d){var e=new XMLHttpRequest,f=(new Date).getTime();e.addEventListener("load",function(){var a=this,e=new Worker(b.URL.createObjectURL(new Blob([a.responseText],{type:"text/javascript"})));c&&c.call(d,e)},!1),e.addEventListener("error",function(a){c&&c.call(d,null,a,f)},!1),e.open("get",a,!0),e.send()}function c(a){e.call(this),this.worker=null,a=a||{},this.options=a,this.inited=!1,this.init()}var d=o.ftnhtml5,e=d.Emitter,f=d.CONST_DEF,g=f.EventType,h=f.AlgType;o.util.extend(c,e);var i={retryGetWorkerTimes:0,maxRetryGetWorkerTimes:1,init:function(){var b=this,c=b.options,d=c.path;a(d,function(a,c,d){if(a){var e=b.worker=a;e.addEventListener("message",function(a){var c=a.data;b._HandleMessage(c)},!1),b.inited=!0,b.emit("init")}else if(b.retryGetWorkerTimes<b.maxRetryGetWorkerTimes)b.retryGetWorkerTimes++,b.init();else{b.emit("message",{eventType:g.REPLY.UPLOAD_ERROR,result:{code:1987,msg:"加载上传组件失败了，请清除缓存后刷新重试",errorType:o.reporter.ErrorType.PLUGIN}});var f=c.target.status,h=c.timeStamp-d,i=c.target.readyState;o.bossReporter.reportError({errorMsg:"获取worker内容失败，status: "+f+", readyState: "+i+", timeStamp: "+h})}},b)},_HandleMessage:function(a){var b=this,c=a.eventType;a.uniqueKey;switch(c){case g.REPLY.SCAN_START:break;case g.REPLY.SCAN_ING:a.result.processed;break;case g.REPLY.SCAN_SUCCESS:break;case g.REPLY.SCAN_CANCEL:break;case g.REPLY.UPLOAD_START:break;case g.REPLY.UPLOAD_ING:break;case g.REPLY.UPLOAD_SUCCESS:break;case g.REPLY.UPLOAD_CANCEL:break;case g.REPLY.UPLOAD_ERROR:}b.emit("message",a)},postMessage:function(a,b){var c=this;c.inited?c.worker.postMessage(a):c.one("init",function(){c.worker.postMessage(a)})},calFileMd5:function(a,b){var c={uniqueKey:a.uniqueKey,eventType:g.SEND.FILE_SCAN,algType:h.MD5,fileInfo:a};this.postMessage(c,b)},calFileSha1:function(a,b){var c={uniqueKey:a.uniqueKey,eventType:g.SEND.FILE_SCAN,algType:h.SHA1,fileInfo:a};this.postMessage(c,b)},calBufferMd5:function(a,b){var c={uniqueKey:a.uniqueKey,eventType:g.SEND.BUF_SCAN,algType:h.MD5,bufferInfo:a};this.postMessage(c,b)},cancelCal:function(a,b,c){var d={uniqueKey:a,eventType:g.SEND.FILE_SCAN_CANCEL,algType:b};this.postMessage(d,c)},uploadFile:function(a,b){var c={uniqueKey:a.uploadKey,eventType:g.SEND.FILE_UPLOAD,fileInfo:a,file:b};this.postMessage(c)},cancelUpload:function(a){var b={uniqueKey:a,eventType:g.SEND.FILE_UPLOAD_CANCEL};this.postMessage(b)},terminate:function(){this.worker&&(this.worker.terminate(),this.worker=null)}};for(var j in i)i.hasOwnProperty(j)&&(c.prototype[j]=i[j]);return c}),function(a,b){o.ftnhtml5=o.ftnhtml5||{},o.ftnhtml5.UploadCore=b()}(b,function(){function a(a,b){f.call(this),this.fio=a||{},this.file=b;for(var c=0,d=k.length;d>c;c++){var e=k[c];this[e]=l}this._init()}var c=o.config,d=c.ftnhtml5,e=o.ftnhtml5,f=e.Emitter,g=e.WorkerAdapter,h=e.CONST_DEF,i=h.EventType,j=h.AlgType,k=(b.jQuery,["onStart","onScanStart","onScanProgress","onUploadStart","onUploadProgress","onSuccess","onCancel","onError"]),l=function(){};o.util.extend(a,f);var m={_init:function(){var a=this;a.on("uploadevent",function(b){var c=b.name,d=b.extData,e=a.fio;a[c]&&a[c](e,d)}),a.on("algfinish",function(b){a._onAlgFinish(b)}),a.on("getvid",function(b){var c=a.fio;c.uploadStatus!=o.global.UploadStatus.UPLOAD&&a.uploadFile()})},start:function(){var a=this;a.fio.uploadStatus=o.global.UploadStatus.READY,a.createWorkerAdapter(),a.emit("uploadevent",{name:"onStart"}),a.scanFile()},cancel:function(){var a=this.fio;a.uploadStatus==o.global.UploadStatus.SCAN?this.cancelScan():a.uploadStatus==o.global.UploadStatus.UPLOAD&&this.cancelUpload()},getVid:function(){},_onAlgFinish:function(a){var b=this,c=b.fio,d=a.algType,e=a.result.hash;d==j.SHA1?(c.sha=e,b.waAlgSha.terminate(),b.waAlgSha=null):(c.md5=e,b.waAlgMd5.terminate(),b.waAlgMd5=null),b._checkAlgHashReady()},_checkAlgHashReady:function(){var a=this,b=a.fio;b.sha&&b.md5&&a.getVid()},_handleMessage:function(a){var b=this,c=b.fio,d=a.eventType;a.uniqueKey;switch(d){case i.REPLY.SCAN_START:b.emit("uploadevent",{name:"onScanStart"});break;case i.REPLY.SCAN_ING:var e=a.algType,f=a.result.processed;e==j.SHA1?c.processedSizeSha=f:c.processedSizeMd5=f,c.processedSize=Math.min(c.processedSizeSha,c.processedSizeMd5),isNaN(c.processedSize)&&(c.processedSize=0),c.percent=(c.processedSize/c.size*100).toFixed(2),b.emit("uploadevent",{name:"onScanProgress",extData:{bytesProcessed:c.processedSize,bytesTotal:c.size}});break;case i.REPLY.SCAN_SUCCESS:b.emit("algfinish",a);break;case i.REPLY.SCAN_CANCEL:b.emit("uploadevent",{name:"onCancel"});break;case i.REPLY.UPLOAD_START:b.emit("uploadevent",{name:"onUploadStart"});break;case i.REPLY.UPLOAD_ING:var f=a.result.processed;c.percent=(f/c.size*100).toFixed(2),b.emit("uploadevent",{name:"onUploadProgress",extData:{bytesProcessed:f,bytesTotal:c.size}});break;case i.REPLY.UPLOAD_SUCCESS:b.emit("uploadevent",{name:"onSuccess"}),b.waUpload.terminate(),b.waUpload=null;break;case i.REPLY.UPLOAD_CANCEL:b.emit("uploadevent",{name:"onCancel"});break;case i.REPLY.UPLOAD_ERROR:c.errorCode=a.result.code,c.errorMsg=a.result.msg,c.errorType=a.result.errorType,c.bossMsg=a.result.bossMsg,b.emit("uploadevent",{name:"onError"});break;case i.REPLY.SET_FIOSTARTTIME_FIOLASTTIME:c.lastTime=c.startTime=a.result.now}},createWorkerAdapter:function(){try{var a=this;a.waAlgMd5||(a.waAlgMd5=new g({path:d.workerPath}),a.waAlgMd5.on("message",function(b){a._handleMessage(b)})),a.waAlgSha||(a.waAlgSha=new g({path:d.workerPath}),a.waAlgSha.on("message",function(b){a._handleMessage(b)})),a.waUpload||(a.waUpload=new g({path:d.workerPath}),a.waUpload.on("message",function(b){"report"==b.type?o.bossReporter.report(b):a._handleMessage(b)}))}catch(b){o.bossReporter.reportUncaughtError({errorMsg:b.message+" at function createWorkerAdapter in file upload.core.js "})}},scanFile:function(){try{var a=this,b=a.fio;b.uploadStatus=o.global.UploadStatus.SCAN,b.md5?a._checkAlgHashReady():a.waAlgMd5.calFileMd5({file:a.file,uniqueKey:b.uploadKey}),b.sha?a._checkAlgHashReady():a.waAlgSha.calFileSha1({file:a.file,uniqueKey:b.uploadKey})}catch(c){o.bossReporter.reportUncaughtError({errorMsg:c.message+" at function scanFile in file upload.core.js "})}},cancelScan:function(){var a=this,b=a.fio,c=b.uploadKey;a.waAlgMd5&&a.waAlgMd5.cancelCal(c,j.MD5),a.waAlgSha&&a.waAlgSha.cancelCal(c,j.SHA1)},uploadFile:function(){try{var a=this,b=a.fio;b.uploadStatus=o.global.UploadStatus.UPLOAD,a.waUpload.uploadFile(b,a.file)}catch(c){o.bossReporter.reportUncaughtError({errorMsg:c.message+" at function uploadFile in file upload.core.js"})}},cancelUpload:function(){var a=this,b=a.fio,c=b.uploadKey;a.waUpload.cancelUpload(c)}};for(var n in m)m.hasOwnProperty(n)&&(a.prototype[n]=m[n]);return a}),o.ftnhtml5Uploader=function(){function e(){function e(a){b.console&&console.log}function f(){var b="",d='<div style="'+w.containerStyle+'"><input name="Filedata" '+b+' type="file" id="'+w.id+'" style="'+w.style+'" width="'+w.width+'" height="'+w.height+'"'+(v.common.useMultiSelect?' multiple="multiple"':"")+" /></div>";return a(c.body).append(d),inputObj=c.getElementById(w.id),!!inputObj}function g(a){var b;return b=new o.FileInfo(o.global.UploadType.FTN_HTML5,a.size,a.name,"",v.common.uploadInfo),b.uploadKey=o.util.getGUID(),b}function h(a){var b=g(a);"https:"==location.protocol&&(b.addrtype=1);var c=new x.UploadCore(b,a);return c.onStart=k,c.onScanStart=l,c.onScanProgress=m,c.onUploadStart=n,c.onUploadProgress=p,c.onSuccess=q,c.onCancel=r,c.onError=s,c.getVid=function(){var a=this,b=a.fio;u.getVid(b,function(c){b.exists=c.exists,b.checkkey=c.checkkey,b.vid=c.vid,b.fid=c.fid,b.serverip=c.serverip,b.serverport=c.serverport,o.bossReporter.report({step:o.bossReporter.STEP.BEFORE,vid:b.vid,uploadServer:b.serverip}),a.emit("getvid")},function(a){b.errorCode=a.em,b.errorMsg=a.msg,b.errorType=o.reporter.ErrorType.CGI,b.dupli_info=a.dupli_info,o.reporter.report(o.reporter.Step.BEFORE,b),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE,vid:b.vid}),s(b)})},y[b.uploadKey]=c,b}function i(){var b,d,e=c.body,f=10;!w.dropTarget&&(w.dropTarget=c.body),e.addEventListener("dragenter",function(c){c.preventDefault(),c.stopPropagation(),b=a.now(),v.event.onDragEnterPage()},!1),e.addEventListener("dragleave",function(c){c.stopPropagation(),c.preventDefault(),a.now()-b>f&&v.event.onDragLeavePage()},!1),e.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()},!1),e.addEventListener("drop",function(a){a.preventDefault(),a.stopPropagation(),v.event.onDragLeavePage()},!1),w.dropTarget.addEventListener("dragenter",function(b){d=a.now(),v.event.onDragEnterTarget()},!1),w.dropTarget.addEventListener("dragleave",function(b){a.now()-d>f&&v.event.onDragLeaveTarget()},!1),w.dropTarget.addEventListener("drop",function(a){var b;v.event.onDragLeaveTarget(),v.event.onDropTarget(),b=a.dataTransfer.files,0!=b.length&&j(b)},!1),inputObj.addEventListener("change",function(a){var b=this.files;0!=b.length&&(j(b),inputObj.value="")},!1),o.bossReporter.report({step:"use ftnhtml5"})}function j(a){for(var b,c=[],d=0,e=a.length;e>d;d++){b=a[d];var f=h(b);c.push(f)}v.event.onSelect(c),o.bossReporter.report({step:o.bossReporter.STEP.SELECT})}function k(a){e("onStart "+a.name),v.event.onStart(a),o.bossReporter.report({step:o.bossReporter.STEP.SCANSTART,vid:a.vid})}function l(a){o.bossReporter.report({step:o.bossReporter.STEP.SCANSTART,vid:a.vid})}function m(a,b){try{u.handleProgressData(a,b),v.event.onScanProgress(a),a.firstBossReportScanning||(o.bossReporter.report({step:o.bossReporter.STEP.SCANNING,vid:a.vid}),a.firstBossReportScanning=1)}catch(c){o.bossReporter.reportUncaughtError({rkey:"ftnhtml5uploader-onScanProgress",errorMsg:c.message+" at function onScanProgress in file tvu.ftnhtml5uploader.js "})}}function n(a){e("onUploadStart "+a.name),v.event.onUploadStart(a),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADSTART,vid:a.vid})}function p(a,b){try{var c=!0;u.handleProgressData(a,b,c),v.event.onUploadProgress(a),a.firstBossReportUploading||(o.bossReporter.report({step:o.bossReporter.STEP.UPLOADING,vid:a.vid}),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADING,uploadInstantSpeed:a.instantSpeed,uploadAverageSpeed:a.averageSpeed}),a.firstBossReportUploading=1),(0==a.instantSpeed||0==a.averageSpeed)&&o.bossReporter.report({step:o.bossReporter.STEP.UPLOADING,uploadInstantSpeed:a.instantSpeed,uploadAverageSpeed:a.averageSpeed})}catch(d){o.bossReporter.reportUncaughtError({rkey:"ftnhtml5uploader-onUploadProgress",errorMsg:d.message+" at function onUploadProgress in file tvu.ftnhtml5uploader.js "})}}function q(a){e("onSuccess "+a.name),a.uploadStatus=o.global.UploadStatus.SUCCESS,v.event.onSuccess(a),o.bossReporter.report({step:o.bossReporter.STEP.FINISHED,vid:a.vid})}function r(a){o.bossReporter.report({step:o.bossReporter.STEP.CANCEL,vid:a.vid})}function s(a){e("onError "+a.name),a.uploadStatus=o.global.UploadStatus.FAIL,v.event.onError(a);var b=a.bossMsg||a.errorMsg;o.bossReporter.reportError({vid:a.vid,errorMsg:"error, errorCode: "+a.errorCode+", errorMsg: "+b})}function t(){try{inputObj.click()}catch(a){o.bossReporter.reportUncaughtError({errorMsg:a+" at function openSelectFileWindow in file tvu.ftnhtml5uploader.js"})}}var u=this,v=o.config,w=v.ftnhtml5,x=o.ftnhtml5,y={};this.inited=!1,this.config=w,this.init=function(){try{if(!u.inited){if(!f())return;i();var a=o.config&&o.config.common&&o.config.common.uploadInfo&&o.config.common.uploadInfo.bid;o.validateCode.init(a),u.inited=!0}}catch(b){o.bossReporter.reportUncaughtError({errorMsg:b+" at function this.init in file tvu.ftnhtml5uploader.js"})}},this.start=function(a){try{var b=a.uploadKey,c=y[b];c&&o.validateCode.validate({bid:a.bid,upload_platform:a.upload_platform},function(b,d){a.ticket=b,a.randstr=d,c.start()},function(b){a.errorCode=b.errorCode,a.errorMsg=b.errorMsg,s(a),u.cancel(a)})}catch(d){o.bossReporter.reportUncaughtError({errorMsg:d+" at function this.start in file tvu.ftnhtml5uploader.js"})}},this.cancel=function(a){try{var b=a.uploadKey,c=y[b];c&&c.cancel()}catch(d){o.bossReporter.reportUncaughtError({errorMsg:d+" at function this.cancel in file tvu.ftnhtml5uploader.js"})}},this.isSupport=function(){if(o.util.userAgent.firefox)return!1;var a=navigator.userAgent,a=b.navigator.userAgent;return a.indexOf("MSIE")>0||a.indexOf("Trident/")>0||a.indexOf("Edge/")>0?!1:b.File!=d&&b.FileReader!=d&&b.Worker!=d&&(new b.XMLHttpRequest).upload!=d},this.openSelectFileWindow=function(){try{t()}catch(a){o.bossReporter.reportUncaughtError({errorMsg:a+" at function this.openSelectFileWindow in file tvu.ftnhtml5uploader.js"})}}}return o.util.extend(e,o.baseUploader),new e}(),o.config.html5={id:"tvu_html5uploader_obj",maxFileSize:200,selectButton:null,dropTarget:null,tcgi:"//c.v.qq.com/vupready",tcgiParamKeys:["vid","bid","type","tags","cat","act","title","folder","orifname","size","uptype","key"],tcgiHttpMethod:"get",upcgi:"//uu.video.qq.com/v1/vupvideo",upcgiParamKeys:["fid","vid","bid","type","tags","cat","act","title","folder","fsize"],width:"0",height:"0",style:"height:0;width:0;margin:0;padding:0;",containerStyle:"height:0;width:0;margin:0;padding:0;visibility:hidden;overflow:hidden;"},o.html5Uploader=function(){function c(){function c(){return t=o.html5Uploader.core,t.init()}function e(){t.onSelect=g,t.onProgress=h,t.onSent=i,t.onSuccess=j,t.onSendError=k,t.onCgiError=l,a(s.selectButton).bind("click",function(a){t.openSelectFileWindow()}),o.bossReporter.report({step:"use html5"})}function f(a){var b;return b=new o.FileInfo(o.global.UploadType.HTML5,a.size,a.name,"",r.common.uploadInfo),b.uploadKey=a.uploadKey,b}function g(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=f(a[c]);u[e.uploadKey]=e.uid,b.push(e)}r.event.onSelect(b),o.bossReporter.report({step:o.bossReporter.STEP.SELECT,vid:e.vid})}function h(a){try{var b,c=q.getFio(a.uploadKey);b=q.handleProgressData(c,a),0==c.firstReport&&(c.firstReport=1,o.reporter.report(o.reporter.Step.START,c),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADSTART,vid:c.vid})),1e3>b||b>1e4&&c.stopNum<60&&(o.reporter.report(o.reporter.Step.PAUSE,c),o.bossReporter.report({step:o.bossReporter.STEP.PAUSE,vid:c.vid}),c.stopNum++),r.event.onUploadProgress(c)}catch(d){o.bossReporter.reportUncaughtError({rkey:"html5uploader-onProgress",errorMsg:d.message+" at function onProgress in file tvu.html5uploader.js "})}}function i(a){var b=q.getFio(a.uploadKey);o.reporter.report(o.reporter.Step.SENT,b),o.bossReporter.report({step:o.bossReporter.STEP.SENT,vid:b.vid})}function j(a){var b=q.getFio(a.uploadKey);b.percent="100.0",o.reporter.report(o.reporter.Step.FINISHED,b),o.bossReporter.report({step:o.bossReporter.STEP.FINISHED,vid:b.vid}),b.uploadStatus=o.global.UploadStatus.SUCCESS,r.event.onSuccess(b)}function k(a){var b=q.getFio(a.uploadKey);b.errorCode=a.errorCode,b.errorType=o.reporter.ErrorType.PLUGIN,o.reporter.report(o.reporter.Step.FINISHED,b),o.bossReporter.reportError({step:"send error, errorCode: "+b.errorCode+" errorMsg: "+a.errorMsg,vid:b.vid}),m(b)}function l(a){var b=q.getFio(a.uploadKey);b.errorCode=a.errorCode,b.errorMsg=a.errorMsg,b.dupli_info=a.dupli_info,b.errorType=o.reporter.ErrorType.CGI,o.reporter.report(o.reporter.Step.FINISHED,b),o.bossReporter.reportError({step:"cgi error, errorCode: "+b.errorCode+" errorMsg: "+b.errorMsg,vid:b.vid}),m(b)}function m(a){a.uploadStatus=o.global.UploadStatus.FAIL,r.event.onError(a),o.bossReporter.reportError({step:"error, errorCode: "+a.errorCode+" errorMsg: "+a.errorMsg,vid:a.vid})}function n(a){r.event.onStart(a),q.getVid(a,function(b){a.vid=b.vid,a.fid=b.fid,o.reporter.report(o.reporter.Step.BEFORE,a),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE,vid:a.vid}),r.event.onUploadStart(a),p(a)},function(b){a.errorCode=b.em,a.errorMsg=b.msg,a.errorType=o.reporter.ErrorType.CGI,a.dupli_info=b.dupli_info,o.reporter.report(o.reporter.Step.BEFORE,a),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE+a.errorMsg,vid:a.vid}),m(a)})}function p(b){b.uploadStatus!=o.global.UploadStatus.CANCEL&&(o.reporter.report(o.reporter.Step.UPLOADING,b),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADING,vid:b.vid}),b.startTime=b.lastTime=a.now(),b.uploadStatus=o.global.UploadStatus.UPLOAD,t.start(b))}var q=this,r=o.config,s=r.html5,t=null,u={};this.inited=!1,this.keyToUidMap=u,this.config=s,this.init=function(){if(!this.inited){c(),e();var a=o.config&&o.config.common&&o.config.common.uploadInfo&&o.config.common.uploadInfo.bid;o.validateCode.init(a),this.inited=!0}},this.start=function(a){q.inited&&o.validateCode.validate({bid:a.bid,upload_platform:a.upload_platform},function(b,c){a.ticket=b,a.randstr=c,n(a)},function(b){a.errorCode=b.errorCode,a.errorMsg=b.errorMsg,m(a),q.cancel(a)})},this.cancel=function(a){q.inited&&(o.reporter.report(o.reporter.Step.CANCEL,a),o.bossReporter.report({step:o.bossReporter.STEP.CANCEL,vid:a.vid}),t.cancel(a))},this.openSelectFileWindow=function(){q.inited&&t.openSelectFileWindow()},this.isSupport=function(){return b.File!=d&&b.FormData!=d&&(new b.XMLHttpRequest).upload!=d}}return o.util.extend(c,o.baseUploader),new c}(),o.html5Uploader.core=function(){function b(){function b(){var b='<div style="'+k.containerStyle+'"><input name="Filedata" accept="video/*" type="file" id="'+k.id+'" style="'+k.style+'" width="'+k.width+'" height="'+k.height+'"'+(j.common.useMultiSelect?' multiple="multiple"':"")+" /></div>";return a(c.body).append(b),h=c.getElementById(k.id),!!h}function d(){var b,d,f=c.body,g=10;!k.dropTarget&&(k.dropTarget=c.body),f.addEventListener("dragenter",function(c){c.preventDefault(),c.stopPropagation(),b=a.now(),j.event.onDragEnterPage()},!1),f.addEventListener("dragleave",function(c){c.stopPropagation(),c.preventDefault(),a.now()-b>g&&j.event.onDragLeavePage()},!1),f.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()},!1),f.addEventListener("drop",function(a){a.preventDefault(),a.stopPropagation(),j.event.onDragLeavePage()},!1),k.dropTarget.addEventListener("dragenter",function(b){d=a.now(),j.event.onDragEnterTarget()},!1),k.dropTarget.addEventListener("dragleave",function(b){a.now()-d>g&&j.event.onDragLeaveTarget()},!1),k.dropTarget.addEventListener("drop",function(a){var b;j.event.onDragLeaveTarget(),j.event.onDropTarget(),b=a.dataTransfer.files,0!=b.length&&e(b)},!1),h.addEventListener("change",function(a){var b=this.files;0!=b.length&&(e(b),h.value="")},!1)}function e(a){try{for(var b,c,d,e,f=[],g=0,h=a.length;h>g;g++)b=a[g],e=o.util.getGUID(),c=b.fileSize||b.size,d=b.fileName||b.name,d=o.util.getFileName(d),f.push({uploadKey:e,name:d,size:c}),l[e]={file:b,xhr:null};i.onSelect(f)}catch(j){o.bossReporter.reportUncaughtError({errorMsg:j.message+" at function onSelect in file tvu.html5uploader.core.js"})}}function f(b){try{var c,d,e=new XMLHttpRequest,f=new FormData,g=l[b.uploadKey].file,h=b.uploadKey,j=k.upcgiParamKeys,m=a.extend({},b);m=o.util.getSubParam(m,j),a.extend(m,{uin:o.config.common.uin,g_tk:o.config.common.g_tk,Filename:b.name,fsize:b.size});for(var n in m)m.hasOwnProperty(n)&&f.append(n,m[n]);f.append("Filedata",g),l[h].xhr=e,d=o.util.param({g_tk:o.config.common.g_tk},k.upcgi),e.open("post",d,!0),e.upload.addEventListener("progress",function(a){a.lengthComputable&&i.onProgress({uploadKey:h,bytesProcessed:a.loaded,bytesTotal:a.total})},!1),e.upload.addEventListener("load",function(a){i.onSent({uploadKey:h}),c=setTimeout(function(){e.abort(),i.onCgiError({uploadKey:h,errorCode:8003,errorMsg:"cgi: "+d+"，错误码：timeout(120)"})},1e3*o.config.common.timeout)},!1),e.upload.addEventListener("error",function(a){i.onSendError({uploadKey:h,errorCode:8001,errorMsg:"cgi: "+d+", 错误码：readyState: "+e.readyState+", status: "+e.status+(e.responseText?", "+e.responseText:"")})},!1),e.addEventListener("load",function(a){clearTimeout(c);var b=e.responseXML,d=b.getElementsByTagName("s");if(d.length>0&&"o"==d[0].textContent)l[h].xhr=null,e=null,i.onSuccess({uploadKey:h});else{var f=o.util.simpleXmlToJson(b),g=f.root;i.onCgiError({uploadKey:h,errorCode:g.em||8002,errorMsg:g.msg||"",dupli_info:g.dupli_info})}},!1),e.addEventListener("error",function(a){clearTimeout(c),i.onCgiError({uploadKey:h,errorCode:e.status||8002,errorMsg:"cgi: "+d+", 错误码：readyState: "+e.readyState+", status: "+e.status+(e.responseText?", "+e.responseText:"")})},!1),e.send(f)}catch(p){o.bossReporter.reportUncaughtError({errorMsg:p.message+" at function startUpload in file tvu.html5uploader.core.js"})}}function g(){h.click()}var h,i=this,j=o.config,k=j.html5,l={};this.inited=!1,this.init=function(){return i.inited?void 0:(b(),d(),i.inited=!0,!!h)},this.start=function(a){i.inited&&f(a)},this.cancel=function(a){var b;i.inited&&(b=l[a.uploadKey].xhr,null!=b&&(b.abort(),b=null))},this.openSelectFileWindow=function(){i.inited&&g()},this.onSelect=a.noop,this.onProgress=a.noop,this.onSent=a.noop,this.onSuccess=a.noop,this.onSendError=a.noop,this.onCgiError=a.noop}return new b}(),o.config.flash={id:"tvu_flashuploader_obj",maxFileSize:200,selectButton:null,tcgi:"//c.v.qq.com/openvupready",tcgiParamKeys:["vid","bid","type","tags","cat","act","title","folder","orifname","size","uptype","key"],tcgiHttpMethod:"get",upcgi:"http://uu.video.qq.com/v1/openvupvideo",upcgiParamKeys:["fid","vid","bid","type","tags","cat","act","title","folder","fsize"],src:location.protocol+"//imgcache.qq.com/tencentvideo_v1/tvu/swf/TenvideoUploader.swf",version:"",show:0,width:"1",height:"1",style:"position:absolute;top:0;left:0;margin:0;padding:0;"},o.flashUploader=function(){function d(){function d(){var b=g(),d=[],e=t.id,f=t.src,h=t.width,i=t.height,j=t.style;return o.util.userAgent.ie?d.push('<object id="',e,'" ','classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" ','codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" ','width="',h,'" height="',i,'" style="'+j+'"','type="application/x-shockwave-flash">','<param name="scale" value="showall" /><param name="wmode" value="transparent" />','<param name="movie" value="',f,'" />','<param name="flashvars" value="',o.util.param(b),'" />','<param name="allowScriptAccess" value="always" /></object>'):d.push('<embed type="application/x-shockwave-flash" id="',e,'" src="',f,'" ','width="',h,'" height="',i,'" style="'+j+' opacity: 0;"','allowScriptAccess="always" scale="showall" wmode="transparent" flashvars="',o.util.param(b),'"></embed>'),a(c.body).append(d.join("")),u=c.getElementById(t.id),!!u}function f(){b.txvFlashCallback={},b.txvFlashCallback.flashInit=function(a){t.version=a.pfversion,u.setTypeFilter([{name:"视频音频文件",type:s.common.fileType}])},b.txvFlashCallback.onSelect=h,b.txvFlashCallback.onProgress=i,b.txvFlashCallback.onSent=j,b.txvFlashCallback.onSuccess=k,b.txvFlashCallback.onError=l}function g(){var a,b,c=s.common;return b=o.util.param({g_tk:s.common.g_tk},t.upcgi),a={upcgi:b,timeout:c.timeout,show:t.show,g_tk:s.common.g_tk}}function h(a,b,c){var d,e=[];a=decodeURIComponent(a),d=new o.FileInfo(o.global.UploadType.FLASH,b,a,"",s.common.uploadInfo),d.errorCode=c,d.uploadKey=d.uid,e.push(d),s.event.onSelect(e),o.bossReporter.report({step:"use flash"}),o.bossReporter.report({step:o.bossReporter.STEP.SELECT,vid:d.vid})}function i(a,b){try{var c,d=r.getFio(q),e={bytesProcessed:a,bytesTotal:b};c=r.handleProgressData(d,e),0==d.firstReport&&(d.firstReport=1,o.reporter.report(o.reporter.Step.START,d),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADSTART,vid:d.vid})),1e3>c||c>1e4&&d.stopNum<60&&(o.reporter.report(o.reporter.Step.PAUSE,d),o.bossReporter.report({step:o.bossReporter.STEP.PAUSE,vid:d.vid}),d.stopNum++),s.event.onUploadProgress(d)}catch(f){o.bossReporter.reportUncaughtError({rkey:"flashuploader-onProgress",errorMsg:f.message+" at function onProgress in file tvu.flashuploader.js "})}}function j(){var a=r.getFio(q);o.reporter.report(o.reporter.Step.SENT,a),o.bossReporter.report({step:o.bossReporter.STEP.SENT,vid:a.vid})}function k(b){var c=r.getFio(q);if("object"==typeof b&&"undefined"!=typeof b.xmlstr){var d=a.parseXML(b.xmlstr),b=o.util.simpleXmlToJson(d);c.dupli_info=b.dupli_info}c.percent="100.0",o.reporter.report(o.reporter.Step.FINISHED,c),o.bossReporter.report({step:o.bossReporter.STEP.FINISHED,vid:c.vid}),c.uploadStatus=o.global.UploadStatus.SUCCESS,s.event.onSuccess(c)}function l(a){var b,c=r.getFio(q);b="object"==typeof a?a.code:a.toString(),clearTimeout(e),e=setTimeout(function(){0!=b&&(c.errorCode=b,c.errorMsg="错误码："+b,c.errorType=o.reporter.ErrorType.PLUGIN,o.reporter.report(o.reporter.Step.FINISHED,c),o.bossReporter.reportError({vid:c.vid,errorMsg:"flash error, errorCode: "+c.errorCode+", errorMsg: "+c.errorMsg}),m(c))},2e3)}function m(a){a.uploadStatus=o.global.UploadStatus.FAIL,o.bossReporter.reportError({errorMsg:"error, errorCode: "+a.errorCode+", errorMsg: "+a.errorMsg,vid:a.vid}),s.event.onError(a)}function n(a){s.event.onStart(a),r.getVid(a,function(b){a.vid=b.vid,a.fid=b.fid,o.reporter.report(o.reporter.Step.BEFORE,a),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE,vid:a.vid}),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADSTART,vid:a.vid}),s.event.onUploadStart(a),p(a)},function(b){a.errorCode=b.em,a.errorMsg=b.msg,a.errorType=o.reporter.ErrorType.CGI,a.dupli_info=b.dupli_info,o.reporter.report(o.reporter.Step.BEFORE,a),o.bossReporter.report({step:o.bossReporter.STEP.BEFORE,vid:a.vid}),m(a)})}function p(b){var c,d;if(b.uploadStatus!=o.global.UploadStatus.CANCEL){c=t.upcgiParamKeys,d=a.extend({},b),d=o.util.getSubParam(d,c),d.uin=s.common.uin,d.g_tk=s.common.g_tk,v[b.uploadKey]=b.uid,q=b.uploadKey,o.reporter.report(o.reporter.Step.UPLOADING,b),o.bossReporter.report({step:o.bossReporter.STEP.UPLOADING,vid:b.vid}),b.uploadStatus=o.global.UploadStatus.UPLOAD,b.startTime=b.lastTime=a.now();try{u.upload(d)}catch(e){o.bossReporter.reportUncaughtError({errorMsg:e.message+" at function uploadFile in file tvu.flashupload.js "})}}}var q,r=this,s=o.config,t=s.flash,u=null,v={};this.inited=!1,this.keyToUidMap=v,this.config=t,this.init=function(){if(!r.inited){d(),f();var a=o.config&&o.config.common&&o.config.common.uploadInfo&&o.config.common.uploadInfo.bid;o.validateCode.init(a),r.inited=!0}},this.start=function(a){r.inited&&o.validateCode.validate({bid:a.bid,upload_platform:a.upload_platform},function(b,c){a.ticket=b,a.randstr=c,n(a)},function(b){a.errorCode=b.errorCode,a.errorMsg=b.errorMsg,m(a),r.cancel(a)})},this.cancel=function(a){
r.inited&&(o.reporter.report(o.reporter.Step.CANCEL,a),o.bossReporter.report({step:o.bossReporter.STEP.CANCEL,vid:a.vid}),u.cancel())},this.isSupport=function(){return!0},this.getSelectButtonOverlay=function(){return u}}var e=!1;return o.util.extend(d,o.baseUploader),new d}(),o.queue={maxParallelNum:1,uidWaitQueue:[],uidUploadQueue:[],getUploadSize:function(){var a=this;return a.uidUploadQueue.length},getWaitSize:function(){var a=this;return a.uidWaitQueue.length},getTotalSize:function(){var a=this;return a.getUploadSize()+a.getWaitSize()},isUploading:function(){var a=this;return a.uidUploadQueue.length>0},add:function(b,c){var d,e,f=this;return b?(d=f.uidWaitQueue,e=a.inArray(b,d),-1==e&&(d=f.uidUploadQueue,e=a.inArray(b,d)),-1!=e?"":(c?f.uidWaitQueue.unshift(b):f.uidWaitQueue.push(b),b)):""},remove:function(b){var c,d,e=this;return b?(c=e.uidWaitQueue,d=a.inArray(b,c),-1==d&&(c=e.uidUploadQueue,d=a.inArray(b,c)),-1==d?"":(c.splice(d,1),b)):""},start:function(b){var c,e,f,g=this,h=[];if(c=g.maxParallelNum-g.uidUploadQueue.length,b==d){if(!c||0==g.uidWaitQueue.length)return h;for(;c&&(e=g.uidWaitQueue.shift());)h.push(e),g.uidUploadQueue.push(e),c--;return h}return c?(f=a.inArray(b,g.uidUploadQueue),-1!=f?"":(g.remove(b),g.uidUploadQueue.push(b),b)):""},cancel:function(a){var b,c,e=this,f=[];if(a==d){b=e.uidUploadQueue.concat(e.uidWaitQueue);for(var g=0,h=b.length;h>g;g++)c=b[g],f.push(c);return e.uidUploadQueue.length=0,e.uidWaitQueue.length=0,f}return e.remove(a)?a:""}},o.uploader=function(){function b(a){switch(a){case o.global.BusinessType.BOKE:u.common.sort=100,u.ftn&&(u.ftn.autoRetry=!0,u.ftn.tcgi=location.protocol+"//c.v.qq.com/fvupready",u.ftn.tcgiParamKeys.push("verification_key","upload_platform")),u.ftnhtml5&&(u.ftnhtml5.autoRetry=!0,u.ftnhtml5.tcgi=location.protocol+"//c.v.qq.com/fvupready",u.ftnhtml5.tcgiParamKeys.push("verification_key","upload_platform")),u.flash&&(u.flash.tcgi=location.protocol+"//c.v.qq.com/vupready",u.flash.upcgi="http://uu.video.qq.com/v1/vupvideo",u.flash.tcgiParamKeys.push("verification_key","upload_platform")),u.html5&&u.html5.tcgiParamKeys.push("verification_key","upload_platform");break;case o.global.BusinessType.QZONE:u.common.sort=200,u.ftn&&(u.ftn.tcgi="//c.v.qq.com/fqzupready"),u.flash&&(u.flash.tcgi="//c.v.qq.com/qzupready",u.flash.tcgiHttpMethod="post",u.flash.upcgi="http://uz.video.qq.com/v1/qzone/qzupvideo");break;case o.global.BusinessType.CLASS:u.common.sort=204,u.ftn&&(u.ftn.tcgi=location.protocol+"//openugc.video.qq.com/open_fvupready",u.ftn.tcgiParamKeys.push("convconf")),u.ftnhtml5&&(u.ftnhtml5.autoRetry=!0,u.ftnhtml5.tcgi=location.protocol+"//openugc.video.qq.com/open_fvupready",u.ftnhtml5.tcgiParamKeys.push("convconf")),u.flash&&(u.flash.tcgi=location.protocol+"//openugc.video.qq.com/open_vupready",u.flash.tcgiHttpMethod="post",u.flash.upcgi="http://uu.video.qq.com/v1/openvupvideo",u.flash.tcgiParamKeys.push("convconf")),u.html5&&(u.html5.tcgi=location.protocol+"//openugc.video.qq.com/open_vupready",u.html5.tcgiHttpMethod="post",u.html5.upcgi="//uu.video.qq.com/v1/openvupvideo",u.html5.tcgiParamKeys.push("convconf"));break;case o.global.BusinessType.WEIXIN:u.common.sort=400,u.ftn&&(u.ftn.autoRetry=!0,"http:"==location.protocol?u.ftn.tcgi="//c.v.qq.com/wxfvupready":u.ftn.tcgi="//sec.video.qq.com/p/c.v/wxfvupready",u.ftn.tcgiParamKeys=["bid","appid","pluginsession","username","size","sha","md5"],u.ftn.upcgiParamKeys=["bid","vid","fid","fsize","appid","pluginsession","username","size","sha","md5"]),u.ftnhtml5&&(u.ftnhtml5.autoRetry=!0,"http:"==location.protocol?u.ftnhtml5.tcgi="//c.v.qq.com/wxfvupready":u.ftnhtml5.tcgi="//sec.video.qq.com/p/c.v/wxfvupready",u.ftnhtml5.tcgiParamKeys=["bid","appid","pluginsession","username","size","sha","md5"],u.ftnhtml5.upcgiParamKeys=["bid","vid","fid","fsize","appid","pluginsession","username","size","sha","md5"]),u.flash&&(""==location.protocol?(u.flash.tcgi="//sec.video.qq.com/p/c.v/wxvupready",u.flash.upcgi="http://sec.video.qq.com/p/uu.video/v1/wxvupvideo",u.flash.src="//imgcache.qq.com/tencentvideo_v1/tvu/swf/tvu.flashuploader.swf"):(u.flash.tcgi="//c.v.qq.com/wxvupready",u.flash.upcgi="http://uu.video.qq.com/v1/wxvupvideo",u.flash.src="//imgcache.qq.com/tencentvideo_v1/tvu/swf/tvu.flashuploader.swf"),u.flash.tcgiHttpMethod="get",u.flash.tcgiParamKeys=["bid","appid","pluginsession","username"],u.flash.upcgiParamKeys=["bid","vid","fid","fsize","appid","pluginsession","username"]),u.html5&&("https:"==location.protocol?(u.html5.tcgi="//sec.video.qq.com/p/c.v/wxvupready",u.html5.upcgi="//sec.video.qq.com/p/uu.video/v1/wxvupvideo"):(u.html5.tcgi="//c.v.qq.com/wxvupready",u.html5.upcgi="//uu.video.qq.com/v1/wxvupvideo"),u.html5.tcgiHttpMethod="get",u.html5.tcgiParamKeys=["bid","appid","pluginsession","username"],u.html5.upcgiParamKeys=["bid","vid","fid","fsize","appid","pluginsession","username"]);break;case o.global.BusinessType.OPEN:u.common.sort=400;var b=location.host,c=/.*om.*\.qq\.com$/.test(b);u.ftn&&(c?u.ftn.tcgi=location.protocol+"//om.qq.com/VideoUpload/FtnReady":u.ftn.tcgi=location.protocol+"//openugc.video.qq.com/open_fvupready",u.ftn.tcgiParamKeys.push("open_uid","open_token")),u.ftnhtml5&&(u.ftnhtml5.autoRetry=!0,c?u.ftnhtml5.tcgi=location.protocol+"//om.qq.com/VideoUpload/FtnReady":u.ftnhtml5.tcgi=location.protocol+"//openugc.video.qq.com/open_fvupready",u.ftnhtml5.tcgiParamKeys.push("open_uid","open_token")),u.flash&&(c?u.flash.tcgi=location.protocol+"//om.qq.com/VideoUpload/UnFtnReady":u.flash.tcgi=location.protocol+"//openugc.video.qq.com/open_vupready",u.flash.tcgiHttpMethod="post","https:"===location.protocol?u.flash.upcgi="https://uu.video.qq.com/v1/openvupvideo":u.flash.upcgi="http://uu.video.qq.com/v1/openvupvideo",u.flash.tcgiParamKeys.push("open_uid","open_token"),u.flash.upcgiParamKeys.push("open_uid","open_token")),u.html5&&(c?u.html5.tcgi=location.protocol+"//om.qq.com/VideoUpload/UnFtnReady":u.html5.tcgi=location.protocol+"//openugc.video.qq.com/open_vupready",u.html5.tcgiHttpMethod="post",u.html5.upcgi="//uu.video.qq.com/v1/openvupvideo",u.html5.tcgiParamKeys.push("open_uid","open_token"),u.html5.upcgiParamKeys.push("open_uid","open_token"));break;case o.global.BusinessType.ACCESS:u.common.sort=400,u.ftn&&(u.ftn.tcgi=location.protocol+"//openugc.video.qq.com/open_access_upload"),u.ftnhtml5&&(u.ftnhtml5.autoRetry=!0,u.ftnhtml5.tcgi=location.protocol+"//openugc.video.qq.com/open_access_upload");break;case o.global.BusinessType.COMMON:default:u.common.sort=400,u.ftn&&(u.ftn.tcgi="//c.v.qq.com/openfvupready"),u.ftnhtml5&&(u.ftnhtml5.autoRetry=!0,u.ftnhtml5.tcgi="//c.v.qq.com/openfvupready"),u.flash&&(u.flash.tcgi="//c.v.qq.com/openvupready",u.flash.tcgiHttpMethod="post",u.flash.upcgi="http://uu.video.qq.com/v1/openvupvideo"),u.html5&&(u.html5.tcgi="//c.v.qq.com/openvupready",u.html5.tcgiHttpMethod="post",u.html5.upcgi="//uu.video.qq.com/v1/openvupvideo")}}function c(b){a.extend(v,b),o.debug=!!v.debug,u.common.uin=v.uin,u.common.encuin=v.encuin,u.common.g_tk=v.g_tk,u.common.businessID=v.businessID,u.common.useMultiSelect=v.useMultiSelect,u.common.isReportBoss=v.isReportBoss,v.uploadInfo&&a.extend(u.common.uploadInfo,v.uploadInfo),o.global.getUploader(v.uploadType)||(v.uploadType=0),o.queue.maxParallelNum=v.maxQueueParallelNum,u.html5&&(u.html5.dropTarget=v.dropTarget)}function d(){u.event.onSelect=g,u.event.onStart=h,u.event.onScanProgress=i,u.event.onUploadStart=j,u.event.onUploadProgress=k,u.event.onSuccess=l,u.event.onError=m,u.event.onDragEnterPage=v.onDragEnterPage,u.event.onDragLeavePage=v.onDragLeavePage,u.event.onDragEnterTarget=v.onDragEnterTarget,u.event.onDragLeaveTarget=v.onDragLeaveTarget,u.event.onDropTarget=v.onDropTarget}function e(){var a,b,c=v.useMultiUploadType,d=[o.global.UploadType.FTN,o.global.UploadType.FTN_HTML5,o.global.UploadType.HTML5,o.global.UploadType.FLASH];if(v.uploadType)b=o.global.getUploader(v.uploadType),b&&b.isSupport()?(b.init(),o.util.log(o.global.getUploaderName(v.uploadType)+"Uploader inited")):v.uploadType=0;else for(var e=0,f=d.length;f>e&&(a=d[e],b=o.global.getUploader(a),!b||!b.isSupport()||(v.uploadType||(v.uploadType=a),b.init(),o.util.log(o.global.getUploaderName(a)+"Uploader inited"),c));e++);}function f(b,c){var d=a(b).eq(0),e=o.global.getUploader(c);c||(c=v.uploadType),e&&c&&e.setSelectButton(d)}function g(a){for(var b,c=0,d=a.length;d>c;c++)b=a[c],o.global.getUploader(b.uploadType).checkFile(b),0!=b.errorCode&&(b.uploadStatus=o.global.UploadStatus.INVALID,b.errorMsg=o.global.getErrorMsg(b.errorCode)||b.errorMsg,b.errorType=o.reporter.ErrorType.PLUGIN),o.global.addFio(b),o.util.log("onFileSelect: "+b.uploadType+", "+b.uid+", "+b.name+", "+b.size+", "+b.errorCode+", "+o.global.getErrorMsg(b.errorCode)||b.errorMsg);v.onFileSelect(a)}function h(a){o.util.log("onFileStart: "+a.uploadType+", "+a.uid+", "+a.name),v.onFileStart(a)}function i(a){v.onFileScanProgress(a)}function j(a){o.util.log("onFileUploadStart: "+a.uploadType+", "+a.uid+", ["+a.vid+"], "+a.name),v.onFileUploadStart(a)}function k(a){v.onFileUploadProgress(a)}function l(a){o.util.log("onFileSuccess: "+a.uploadType+", "+a.uid+", ["+a.vid+"], "+a.name),o.queue.remove(a.uid),v.onFileSuccess(a),n()}function m(a){o.util.log("onFileError: "+a.uploadType+", "+a.uid+", ["+(a.vid||"no vid")+"], "+a.name+" Error: "+a.errorCode+", "+o.global.getErrorMsg(a.errorCode)||a.errorMsg),a.errorMsg=o.global.getErrorMsg(a.errorCode)||a.errorMsg,o.queue.remove(a.uid),v.onFileError(a),n()}function n(){0==o.queue.getTotalSize()?v.onQueueEmpty():q()}function p(a,b){var c="";return a&&a instanceof o.FileInfo&&(a.uploadStatus==o.global.UploadStatus.READY||a.uploadStatus==o.global.UploadStatus.FAIL||a.uploadStatus==o.global.UploadStatus.CANCEL)&&(c=o.queue.add(a.uid,b),c&&o.FileInfo.reset(a)),!!c}function q(){for(var a,b,c=o.queue.start(),d=0,e=c.length;e>d;d++)a=c[d],b=o.global.getFio(a),o.FileInfo.reset(b),o.global.getUploader(b.uploadType).start(b)}function r(a){var b="";return a&&a instanceof o.FileInfo&&(a.uploadStatus==o.global.UploadStatus.READY||a.uploadStatus==o.global.UploadStatus.FAIL||a.uploadStatus==o.global.UploadStatus.CANCEL)&&(b=o.queue.start(a.uid),b&&(o.FileInfo.reset(a),o.global.getUploader(a.uploadType).start(a))),!!b}function s(){for(var a,b,c=o.queue.cancel(),d=0,e=c.length;e>d;d++)a=c[d],b=o.global.getFio(a),b.uploadStatus!=o.global.UploadStatus.READY&&o.global.getUploader(b.uploadType).cancel(b),b.uploadStatus=o.global.UploadStatus.CANCEL;n()}function t(a){var b="";return a&&a instanceof o.FileInfo&&(a.uploadStatus==o.global.UploadStatus.READY||a.uploadStatus==o.global.UploadStatus.SCAN||a.uploadStatus==o.global.UploadStatus.UPLOAD)&&(b=o.queue.cancel(a.uid),b&&(a.uploadStatus!=o.global.UploadStatus.READY&&o.global.getUploader(a.uploadType).cancel(a),a.uploadStatus=o.global.UploadStatus.CANCEL)),n(),!!b}var u=o.config,v={uin:0,encuin:"",g_tk:"",businessID:"",businessType:o.global.BusinessType.COMMON,uploadType:0,useMultiUploadType:!1,maxQueueParallelNum:1,useMultiSelect:!1,selectButton:null,dropTarget:null,uploadInfo:null,onDragEnterPage:a.noop,onDragLeavePage:a.noop,onDragEnterTarget:a.noop,onDragLeaveTarget:a.noop,onDropTarget:a.noop,onFileSelect:a.noop,onFileStart:a.noop,onFileScanProgress:a.noop,onFileUploadStart:a.noop,onFileUploadProgress:a.noop,onFileSuccess:a.noop,onFileError:a.noop,onQueueEmpty:a.noop,debug:!1},w=!1;return{core:o,BusinessType:o.global.BusinessType,UploadType:o.global.UploadType,init:function(a){return w||(!a&&(a={}),b(a.businessType),c(a),d(),e(),f(v.selectButton),w=!0),v.uploadType||o.util.log("no uploader inited"),v.uploadType},hasFtn:function(){var a=o.global.getUploader(o.global.UploadType.FTN);return a&&a.isSupport()},hasHtml5:function(){var a=o.global.getUploader(o.global.UploadType.HTML5);return a&&a.isSupport()},hasFtnHtml5:function(){var a=o.global.getUploader(o.global.UploadType.FTN_HTML5);return a&&a.isSupport()},selectFile:function(a,b){var c=o.global.getUploader(o.global.UploadType.FTN);c&&c.selectFile(a,b)},openSelectFileWindow:function(a){a||(a=v.uploadType),o.global.getUploader(a).openSelectFileWindow()},setSelectButton:function(a,b){f(a,b)},addToQueue:function(a,b){return p(a,b)},startQueue:function(){q()},start:function(a){return r(a)},cancelQueue:function(){s()},cancel:function(a){return t(a)},getQueueTotalSize:function(){return o.queue.getTotalSize()},getQueueUploadSize:function(){return o.queue.getUploadSize()},getQueueWaitSize:function(){return o.queue.getWaitSize()},getUploadType:function(){return v.uploadType},getInstallFtnUrl:function(a){return u.common.installFtnUrl+encodeURIComponent(a)},getSizeString:function(a){return o.util.getSizeString(a)}}}();var G=b.onerror;return b.onerror=function(a,b,c,d,e){var f=/tvu\.upload/;if(e){var g=e;f.test(g)&&o.bossReporter.reportError({errorMsg:g})}else{var g=a+" at [ "+b+" ] in line: "+c+", col: "+d;f.test(g)&&o.bossReporter.reportError({errorMsg:g})}G&&G()},o.uploader},jQuery,window,document);